<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inspired Tales</title>
  <meta name="description" content="Servidor de hist√≥rias responsivo com publica√ß√£o, feedback e apoio via Pix." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f7f9fc; --card: #ffffff; --text: #0f172a; --muted: #475569;
      --primary: #2563eb; --primary-weak: #e6f0ff; --accent: #22d3ee;
      --danger: #ef4444; --success: #16a34a; --border: #e2e8f0;
      --radius: 14px; --radius-sm: 10px; --shadow: 0 10px 30px rgba(15,23,42,0.08);
      --container: 1100px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; background: linear-gradient(180deg,#fbfcff 0%,var(--bg) 100%);
      color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height: 1.55;
    }
    .container { width: 100%; max-width: var(--container); margin: 0 auto; padding: 0 20px; }
    header { position: sticky; top: 0; z-index: 100; backdrop-filter: saturate(180%) blur(10px); background: rgba(255,255,255,0.7); border-bottom: 1px solid var(--border); }
    .nav { height: 64px; display: flex; align-items: center; justify-content: space-between; }
    .brand { display: flex; align-items: center; gap: 12px; font-weight: 700; letter-spacing: 0.2px; }
    .logo { width: 34px; height:34px; border-radius:50%; background: radial-gradient(circle at 30% 30%, var(--primary), var(--accent)); box-shadow: var(--shadow); border: 2px solid #fff; }
    .menu { display: flex; gap: 14px; flex-wrap: wrap; }
    .menu a, .menu button {
      color: var(--muted); text-decoration: none; font-weight: 600; padding: 8px 10px; border-radius: 10px; border: none; background: transparent; cursor: pointer;
    }
    .menu a:hover, .menu button:hover { background: var(--primary-weak); color: var(--text); }
    .hero { padding: 60px 0 20px; }
    .hero-grid { display: grid; grid-template-columns: 1.1fr 0.9fr; gap: 24px; align-items: center; }
    .title { font-size: clamp(28px,5vw,42px); margin: 6px 0 10px; letter-spacing: -0.5px; color: var(--primary); }
    .subtitle { color: var(--muted); font-size: 16px; }
    .actions { display:flex; gap:12px; margin-top: 16px; flex-wrap: wrap; }
    .btn {
      display:inline-flex; align-items:center; gap:10px; padding: 12px 16px; border-radius: 10px; border: 1px solid var(--border);
      background:#fff; color: var(--text); text-decoration:none; font-weight:700; box-shadow: var(--shadow); cursor: pointer;
    }
    .btn.primary { background: var(--text); color: #fff; border-color: transparent; }
    .btn.success { background: var(--success); color: #fff; border-color: transparent; }
    .btn.danger { background: var(--danger); color: #fff; border-color: transparent; }
    .btn:hover { transform: translateY(-1px); transition: transform 150ms ease; }
    section { padding: 32px 0; }
    .section-title { font-size: 22px; margin: 0 0 16px; }
    .grid { display: grid; gap: 16px; }
    .grid-3 { grid-template-columns: repeat(3, 1fr); }
    .grid-2 { grid-template-columns: repeat(2, 1fr); }
    @media (max-width: 980px) {
      .hero-grid, .grid-3, .grid-2 { grid-template-columns: 1fr; }
      .menu { gap: 8px; }
    }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); padding: 18px; }
    .small { font-size: 13px; color: var(--muted); }
    .story-thumb { aspect-ratio: 16/9; border-radius: 12px; border: 1px solid var(--border); background: linear-gradient(135deg,#eaf2ff,#f3fff9); margin-bottom: 12px; }
    .story-footer { display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }
    .link { font-weight:700; color: var(--primary); text-decoration:none; border-bottom: 2px solid transparent; }
    .link:hover { border-color: var(--primary); }
    .modal { position: fixed; inset: 0; display: none; place-items: center; background: rgba(15,23,42,0.35); z-index: 200; }
    .modal.open { display: grid; }
    .modal-card { width: min(92vw, 560px); background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); padding: 18px; }
    .modal-head { display:flex; align-items:center; justify-content: space-between; margin-bottom: 10px; }
    .input, textarea { width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 10px; background:#fff; color: var(--text); font-size:14px; }
    .input:focus-visible, textarea:focus-visible { outline: 2px solid var(--primary); outline-offset: 2px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 560px) { .row { grid-template-columns: 1fr; } }
    .notice { background: #fffbeb; border: 1px solid #fde68a; color: #92400e; padding: 12px; border-radius: 12px; margin: 10px 0; }
    .maintenance { text-align: center; padding: 30px 18px; }
    footer { margin-top: 20px; padding: 24px 0 40px; color: var(--muted); text-align: center; }
    .badge { display:inline-flex; align-items:center; gap:8px; background:#fff; border:1px solid var(--border); color:var(--muted); padding:8px 12px; border-radius:999px; box-shadow:var(--shadow); font-size:13px; }
    .tag { display:inline-block; font-size:12px; color: var(--muted); background:#fff; border:1px solid var(--border); padding:6px 10px; border-radius:999px; margin: 6px 6px 0 0; }
  </style>
</head>
<body>
  <header aria-label="Cabe√ßalho do site">
    <div class="container nav">
      <div class="brand">
        <span class="logo" aria-hidden="true"></span>
        <span>Inspired Tales</span>
      </div>
      <nav class="menu" aria-label="Menu principal">
        <a href="#home">Home</a>
        <a href="#catalogo">Hist√≥rias</a>
        <a href="#feedback">Feedback</a>
        <button id="apoieBtn">Apoie o site ‚ù§Ô∏è</button>
        <button id="loginBtn">Entrar</button>
        <button id="adminBtn">Admin</button>
      </nav>
    </div>
  </header>

  <main id="home">
    <section class="hero container">
      <div class="hero-grid">
        <div>
          <span class="badge" id="userBadge">Visitante an√¥nimo</span>
          <h1 class="title">Leia, crie e compartilhe hist√≥rias. Comunidade que cresce junto.</h1>
          <p class="subtitle">
            Ep√≠logos gratuitos, cap√≠tulos publicados pelos autores e espa√ßo para novas ideias. Entre com email/senha ou como an√¥nimo para come√ßar a ler. Para publicar, fa√ßa login.
          </p>
          <div class="actions">
            <a class="btn primary" href="#catalogo">Explorar hist√≥rias</a>
            <button class="btn" id="novaHistoriaBtn">Criar hist√≥ria</button>
          </div>
          <div class="notice" id="maintenanceNotice" style="display:none;">
            Modo manuten√ß√£o ativo: leitura dispon√≠vel, mas publica√ß√£o e feedback podem estar indispon√≠veis temporariamente.
          </div>
        </div>
        <div>
          <div class="card">
            <h3>Como funciona</h3>
            <ul style="padding-left:18px; margin: 8px 0;">
              <li>Qualquer usu√°rio logado pode publicar hist√≥rias</li>
              <li>Ep√≠logo gratuito e cap√≠tulos organizados</li>
              <li>Apoie via Pix com qualquer valor</li>
              <li>Feedback para melhorar a plataforma</li>
            </ul>
            <div style="margin-top:10px;">
              <span class="tag">Acess√≠vel</span>
              <span class="tag">Responsivo</span>
              <span class="tag">Comunidade</span>
              <span class="tag">Pix</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Cat√°logo -->
    <section class="container" id="catalogo" aria-labelledby="catalogo-title">
      <h2 class="section-title" id="catalogo-title">Cat√°logo de hist√≥rias</h2>
      <div class="grid grid-3" id="storiesGrid">
        <!-- Gerado via Firestore -->
      </div>
    </section>

    <!-- Feedback -->
    <section class="container" id="feedback" aria-labelledby="feedback-title">
      <h2 class="section-title" id="feedback-title">Feedback da comunidade</h2>
      <div class="grid grid-2">
        <div class="card">
          <form id="feedbackForm">
            <div class="row">
              <div>
                <label class="small" for="fbNome">Seu nome (opcional)</label>
                <input class="input" id="fbNome" name="nome" placeholder="Nome" />
              </div>
              <div>
                <label class="small" for="fbEmail">Email (opcional)</label>
                <input class="input" id="fbEmail" name="email" type="email" placeholder="voce@exemplo.com" />
              </div>
            </div>
            <div style="margin-top:10px;">
              <label class="small" for="fbMsg">Mensagem</label>
              <textarea class="input" id="fbMsg" name="mensagem" rows="4" placeholder="O que podemos melhorar?" required></textarea>
            </div>
            <div style="margin-top:10px; display:flex; gap:10px;">
              <button class="btn primary" type="submit">Enviar feedback</button>
              <span class="small" id="fbStatus"></span>
            </div>
          </form>
        </div>
        <div class="card">
          <h3>√öltimos feedbacks</h3>
          <div id="feedbackList" class="grid" style="margin-top:10px;">
            <!-- Renderizado via Firestore -->
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    ¬© 2025 ‚Ä¢ Inspired Tales - Apoie via Pix para manter o projeto crescendo.
  </footer>

  <!-- Modal Apoie -->
  <div class="modal" id="apoieModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-labelledby="apoieTitle" aria-modal="true">
      <div class="modal-head">
        <h3 id="apoieTitle">Apoie o site ‚ù§Ô∏è</h3>
        <button class="btn" id="apoieClose">Fechar</button>
      </div>
      <p class="small">Se voc√™ gosta deste projeto, envie qualquer valor simb√≥lico. Sua ajuda mant√©m o servidor ativo e permite trazer mais hist√≥rias.</p>
      <div class="card" style="padding:12px;">
        <strong>Chave Pix:</strong>
        <p id="pixKey" style="word-break: break-all; margin:8px 0;">tarctata26@gmail.com</p>
        <button class="btn" id="copyPix">Copiar chave Pix</button>
      </div>
    </div>
  </div>

  <!-- Modal Login -->
  <div class="modal" id="loginModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-labelledby="loginTitle" aria-modal="true">
      <div class="modal-head">
        <h3 id="loginTitle">Entrar</h3>
        <button class="btn" id="loginClose">Fechar</button>
      </div>
      <div class="row">
        <div>
          <label class="small" for="loginEmail">Email</label>
          <input class="input" id="loginEmail" type="email" placeholder="voce@exemplo.com" />
        </div>
        <div>
          <label class="small" for="loginPass">Senha</label>
          <input class="input" id="loginPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>
      </div>
      <div style="margin-top:10px; display:flex; gap:10px; flex-wrap: wrap;">
        <button class="btn primary" id="loginSubmit">Entrar</button>
        <button class="btn" id="registerSubmit">Criar conta</button>
        <button class="btn" id="anonSubmit">Entrar como an√¥nimo</button>
        <span class="small" id="loginStatus"></span>
      </div>
    </div>
  </div>

  <!-- Modal Nova Hist√≥ria -->
  <div class="modal" id="storyModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-labelledby="storyModalTitle" aria-modal="true">
      <div class="modal-head">
        <h3 id="storyModalTitle">Nova hist√≥ria</h3>
        <button class="btn" id="storyClose">Fechar</button>
      </div>
      <form id="storyForm">
        <div class="row">
          <div>
            <label class="small" for="storyTitle">T√≠tulo</label>
            <input class="input" id="storyTitle" required />
          </div>
          <div>
            <label class="small" for="storyCategory">Categoria</label>
            <input class="input" id="storyCategory" placeholder="Fantasia, Romance..." required />
          </div>
        </div>
        <div style="margin-top:8px;">
          <label class="small" for="storyEp">Ep√≠logo (gratuito)</label>
          <textarea class="input" id="storyEp" rows="3" required></textarea>
        </div>
        <div style="margin-top:8px;">
          <label class="small" for="storyChapters">Cap√≠tulos (um por linha)</label>
          <textarea class="input" id="storyChapters" rows="4" placeholder="Cap√≠tulo 1\nCap√≠tulo 2"></textarea>
        </div>
        <div style="margin-top:10px; display:flex; gap:10px;">
          <button class="btn success" type="submit">Publicar</button>
          <span class="small" id="storyFormStatus"></span>
        </div>
      </form>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    // ===== Substitua com suas credenciais Firebase =====
   const firebaseConfig = {
   apiKey: "AIzaSyAfyB5KbUIS_f0309o3mgcxHtOr8Dn-3xo",
   authDomain: "bank-611aa.firebaseapp.com",
   projectId: "bank-611aa",
   storageBucket: "bank-611aa.firebasestorage.app",
   messagingSenderId: "264221541584",
   appId: "1:264221541584:web:19a1c70abad4b126b7cad5",
   measurementId: "G-Y7CH5HFLJX"
   };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ===== Config de Admin =====
    // Liste emails com permiss√£o de admin (inclusive o seu)
    const ADMINS = ["voce@exemplo.com"];

    // ===== Util =====
    const qs = (sel, ctx=document) => ctx.querySelector(sel);
    const qsa = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const openModal = (id) => qs(id).classList.add('open');
    const closeModal = (id) => qs(id).classList.remove('open');
    const toast = (el, msg, color='#475569') => { el.textContent = msg; el.style.color = color; setTimeout(() => { el.textContent = ''; }, 2500); };

    let currentUser = null;
    let maintenance = false;
    let pixKey = "tarctata26@gmail.com";

    // ===== Auth UI =====
    const updateUserBadge = () => {
      const badge = qs('#userBadge');
      if (!currentUser) badge.textContent = 'Visitante an√¥nimo';
      else if (currentUser.isAnonymous) badge.textContent = 'An√¥nimo (leitura)';
      else badge.textContent = `Logado: ${currentUser.email}`;
    };

    auth.onAuthStateChanged(async (user) => {
      currentUser = user || null;
      updateUserBadge();
      await loadSettings();
      await renderStories();
      await renderFeedbacks();
    });

    // ===== Settings (maintenance, pixKey) =====
    async function loadSettings() {
      const doc = await db.collection('settings').doc('global').get();
      if (doc.exists) {
        const data = doc.data();
        maintenance = !!data.maintenance;
        pixKey = data.pixKey || pixKey;
      }
      qs('#maintenanceNotice').style.display = maintenance ? 'block' : 'none';
      qs('#pixKey').textContent = pixKey;
    }

    async function saveSettings(partial) {
      const docRef = db.collection('settings').doc('global');
      await docRef.set(partial, { merge: true });
      await loadSettings();
    }

    // ===== Stories =====
    async function renderStories() {
      const grid = qs('#storiesGrid');
      grid.innerHTML = '';
      const snap = await db.collection('stories').orderBy('createdAt', 'desc').get();
      if (snap.empty) {
        grid.innerHTML = '<div class="card"><p class="small">Nenhuma hist√≥ria publicada ainda.</p></div>';
        return;
      }
      snap.forEach(doc => {
        const s = doc.data();
        const id = doc.id;
        const isOwner = currentUser && !currentUser.isAnonymous && currentUser.uid === s.authorId;
        const isAdmin = currentUser && !currentUser.isAnonymous && ADMINS.includes(currentUser.email);
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <div class="story-thumb" aria-hidden="true"></div>
          <h3>${s.title}</h3>
          <p class="small">Autor: ${s.authorName || 'Autor'} ‚Ä¢ Categoria: ${s.category || '-'}</p>
          <p style="margin-top:8px;">Ep√≠logo (gratuito): ${s.epilogue ? s.epilogue.slice(0, 120) : ''}${s.epilogue && s.epilogue.length > 120 ? '...' : ''}</p>
          <div class="story-footer">
            <button class="btn" data-open="${id}">Ler</button>
            ${isOwner ? `<button class="btn" data-edit="${id}">Editar</button><button class="btn danger" data-del="${id}">Excluir</button>` : ''}
            ${isAdmin && !isOwner ? `<button class="btn danger" data-del="${id}">Remover (admin)</button>` : ''}
          </div>
        `;
        grid.appendChild(card);
      });

      qsa('[data-open]').forEach(btn => btn.addEventListener('click', async () => {
        const id = btn.getAttribute('data-open');
        const doc = await db.collection('stories').doc(id).get();
        if (!doc.exists) return;
        const s = doc.data();
        const chaptersList = (s.chapters || []).map(c => `<li>${c}</li>`).join('');
        qs('#storyModalTitle').textContent = s.title;
        qs('#storyFormStatus').textContent = '';
        qs('#storyForm').reset(); // n√£o usar aqui, apenas leitura
        qs('#storyModal').querySelector('.modal-head h3').textContent = s.title;
        const content = qs('#storyModal').querySelector('form'); // reuso do modal n√£o √© ideal para leitura, ent√£o criaremos inline tempor√°rio
      }));

      // leitura simples inline (sem reuso de form)
      qsa('[data-open]').forEach(btn => btn.addEventListener('click', async () => {
        const id = btn.getAttribute('data-open');
        const doc = await db.collection('stories').doc(id).get();
        if (!doc.exists) return;
        const s = doc.data();
        const contentEl = document.createElement('div');
        contentEl.innerHTML = `
          <div class="modal-card">
            <div class="modal-head">
              <h3>${s.title}</h3>
              <button class="btn" id="tempClose">Fechar</button>
            </div>
            <p class="small">Autor: ${s.authorName || 'Autor'} ‚Ä¢ Categoria: ${s.category || '-'}</p>
            <h5 style="margin:10px 0 6px;">Ep√≠logo</h5>
            <p>${(s.epilogue || '').replace(/\n/g,'<br/>')}</p>
            <h5 style="margin:14px 0 6px;">Cap√≠tulos</h5>
            <ul style="padding-left:18px; margin:0;">
              ${(s.chapters || []).map(c => `<li>${c}</li>`).join('')}
            </ul>
          </div>
        `;
        const overlay = document.createElement('div');
        overlay.className = 'modal open';
        overlay.appendChild(contentEl);
        document.body.appendChild(overlay);
        overlay.querySelector('#tempClose').addEventListener('click', () => document.body.removeChild(overlay));
      }));

      // editar
      qsa('[data-edit]').forEach(btn => btn.addEventListener('click', async () => {
        if (!currentUser || currentUser.isAnonymous) { alert('Fa√ßa login para editar.'); return; }
        const id = btn.getAttribute('data-edit');
        const doc = await db.collection('stories').doc(id).get();
        if (!doc.exists) return;
        const s = doc.data();
        qs('#storyTitle').value = s.title || '';
        qs('#storyCategory').value = s.category || '';
        qs('#storyEp').value = s.epilogue || '';
        qs('#storyChapters').value = (s.chapters || []).join('\n');
        qs('#storyForm').dataset.storyId = id;
        qs('#storyFormStatus').textContent = 'Editando hist√≥ria existente.';
        openModal('#storyModal');
      }));

      // excluir
      qsa('[data-del]').forEach(btn => btn.addEventListener('click', async () => {
        const id = btn.getAttribute('data-del');
        if (!currentUser || currentUser.isAnonymous) { alert('Fa√ßa login.'); return; }
        const doc = await db.collection('stories').doc(id).get();
        if (!doc.exists) return;
        const s = doc.data();
        const isOwner = currentUser.uid === s.authorId;
        const isAdmin = ADMINS.includes(currentUser.email || '');
        if (!isOwner && !isAdmin) { alert('Sem permiss√£o.'); return; }
        if (!confirm('Confirmar exclus√£o?')) return;
        await db.collection('stories').doc(id).delete();
        await renderStories();
      }));
    }

    // ===== Criar/Atualizar hist√≥ria =====
    qs('#novaHistoriaBtn').addEventListener('click', () => {
      if (maintenance) { alert('Indispon√≠vel durante manuten√ß√£o.'); return; }
      if (!currentUser || currentUser.isAnonymous) { alert('Fa√ßa login para publicar.'); return; }
      qs('#storyForm').reset();
      delete qs('#storyForm').dataset.storyId;
      qs('#storyFormStatus').textContent = '';
      openModal('#storyModal');
    });

    qs('#storyClose').addEventListener('click', () => closeModal('#storyModal'));

    qs('#storyForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (maintenance) { toast(qs('#storyFormStatus'), 'Indispon√≠vel na manuten√ß√£o.', '#ef4444'); return; }
      if (!currentUser || currentUser.isAnonymous) { toast(qs('#storyFormStatus'), 'Fa√ßa login para publicar.', '#ef4444'); return; }
      const title = qs('#storyTitle').value.trim();
      const category = qs('#storyCategory').value.trim();
      const epilogue = qs('#storyEp').value.trim();
      const chapters = qs('#storyChapters').value.split('\n').map(s => s.trim()).filter(Boolean);

      const payload = {
        title, category, epilogue, chapters,
        authorId: currentUser.uid,
        authorName: currentUser.email || 'Autor',
        createdAt: Date.now(),
        updatedAt: Date.now()
      };

      const editingId = qs('#storyForm').dataset.storyId;
      if (editingId) {
        // seguran√ßa: checa owner no client (server via rules tamb√©m)
        const doc = await db.collection('stories').doc(editingId).get();
        const s = doc.data();
        const isOwner = currentUser.uid === s.authorId;
        const isAdmin = ADMINS.includes(currentUser.email || '');
        if (!isOwner && !isAdmin) { toast(qs('#storyFormStatus'), 'Sem permiss√£o para editar.', '#ef4444'); return; }
        await db.collection('stories').doc(editingId).set({ ...s, ...payload, createdAt: s.createdAt }, { merge: true });
      } else {
        await db.collection('stories').add(payload);
      }
      toast(qs('#storyFormStatus'), 'Hist√≥ria salva.', '#16a34a');
      closeModal('#storyModal');
      await renderStories();

      qs('#storyForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  // bloqueios
  if (maintenance) { 
    toast(qs('#storyFormStatus'), 'Indispon√≠vel na manuten√ß√£o.', '#ef4444'); 
    return; 
  }
  if (!currentUser || currentUser.isAnonymous) { 
    toast(qs('#storyFormStatus'), 'Fa√ßa login para publicar.', '#ef4444'); 
    return; 
  }

  // coleta dos dados
  const title = qs('#storyTitle').value.trim();
  const category = qs('#storyCategory').value.trim();
  const epilogue = qs('#storyEp').value.trim();
  const chapters = qs('#storyChapters').value.split('\n').map(s => s.trim()).filter(Boolean);

  // üîë aqui entra o trecho que voc√™ mostrou:
  await db.collection("stories").add({
    title,
    category,
    epilogue,
    chapters,
    authorId: currentUser.uid,
    authorName: currentUser.email || "Autor",
    createdAt: Date.now()
  });

  toast(qs('#storyFormStatus'), 'Hist√≥ria publicada!', '#16a34a');
  closeModal('#storyModal');
  renderStories(); // atualiza cat√°logo
});

    });

    // ===== Feedback =====
    async function renderFeedbacks() {
      const list = qs('#feedbackList');
      list.innerHTML = '';
      const snap = await db.collection('feedbacks').orderBy('createdAt', 'desc').limit(20).get();
      if (snap.empty) {
        list.innerHTML = '<p class="small">Ainda sem feedbacks. Seja o primeiro!</p>';
        return;
      }
      snap.forEach(doc => {
        const fb = doc.data();
        const item = document.createElement('div');
        item.className = 'card';
        item.innerHTML = `<strong>${fb.nome || 'An√¥nimo'}</strong><p class="small" style="margin-top:6px;">${fb.mensagem}</p>`;
        list.appendChild(item);
      });
    }

    qs('#feedbackForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (maintenance) { toast(qs('#fbStatus'), 'Indispon√≠vel na manuten√ß√£o.', '#ef4444'); return; }
      const nome = qs('#fbNome').value;
      const email = qs('#fbEmail').value;
      const mensagem = qs('#fbMsg').value;
      await db.collection('feedbacks').add({ nome, email, mensagem, createdAt: Date.now() });
      toast(qs('#fbStatus'), 'Feedback enviado, obrigada!', '#16a34a');
      e.target.reset();
      await renderFeedbacks();
    });

    // ===== Apoie modal =====
    qs('#apoieBtn').addEventListener('click', () => openModal('#apoieModal'));
    qs('#apoieClose').addEventListener('click', () => closeModal('#apoieModal'));
    qs('#copyPix').addEventListener('click', async () => {
      const key = qs('#pixKey').textContent.trim();
      try { await navigator.clipboard.writeText(key); alert('Chave Pix copiada!'); }
      catch { alert('N√£o foi poss√≠vel copiar.'); }
    });

    // ===== Login modal =====
    qs('#loginBtn').addEventListener('click', () => openModal('#loginModal'));
    qs('#loginClose').addEventListener('click', () => closeModal('#loginModal'));
    qs('#loginSubmit').addEventListener('click', async () => {
      const email = qs('#loginEmail').value.trim();
      const pass = qs('#loginPass').value.trim();
      try { await auth.signInWithEmailAndPassword(email, pass); closeModal('#loginModal'); }
      catch (e) { toast(qs('#loginStatus'), 'Falha ao entrar.', '#ef4444'); }
    });
    qs('#registerSubmit').addEventListener('click', async () => {
      const email = qs('#loginEmail').value.trim();
      const pass = qs('#loginPass').value.trim();
      try { await auth.createUserWithEmailAndPassword(email, pass); closeModal('#loginModal'); }
      catch (e) { toast(qs('#loginStatus'), 'Falha ao registrar.', '#ef4444'); }
    });
    qs('#anonSubmit').addEventListener('click', async () => {
      try { await auth.signInAnonymously(); closeModal('#loginModal'); }
      catch (e) { toast(qs('#loginStatus'), 'Falha ao entrar como an√¥nimo.', '#ef4444'); }
    });

    // ===== Admin (maintenance + pix key) =====
    qs('#adminBtn').addEventListener('click', async () => {
      if (!currentUser || currentUser.isAnonymous || !ADMINS.includes(currentUser.email || '')) {
        alert('Acesso restrito √† administra√ß√£o.');
        return;
      }
      // modal simples inline
      const contentEl = document.createElement('div');
      contentEl.innerHTML = `
        <div class="modal-card">
          <div class="modal-head">
            <h3>Painel Administrativo</h3>
            <button class="btn" id="adminClose">Fechar</button>
          </div>
          <div class="card">
            <h4>Manuten√ß√£o</h4>
            <p class="small">Ative para bloquear publica√ß√£o e feedback; leitura continua dispon√≠vel.</p>
            <div style="margin-top:8px; display:flex; gap:10px;">
              <button class="btn danger" id="toggleMaintenance">Alternar manuten√ß√£o</button>
              <span class="small" id="maintenanceStatus">Status: ${maintenance ? 'ligado' : 'desligado'}</span>
            </div>
          </div>
          <div class="card" style="margin-top:12px;">
            <h4>Chave Pix</h4>
            <p class="small">Chave atual: <span id="pixKeyInline">${pixKey}</span></p>
            <div class="row" style="margin-top:8px;">
              <div>
                <label class="small" for="pixKeyInput">Nova chave Pix</label>
                <input class="input" id="pixKeyInput" placeholder="seu.email@pix.com" />
              </div>
            </div>
            <button class="btn" id="savePix" style="margin-top:10px;">Salvar</button>
            <span class="small" id="adminStatus"></span>
          </div>
        </div>
      `;
      const overlay = document.createElement('div');
      overlay.className = 'modal open';
      overlay.appendChild(contentEl);
      document.body.appendChild(overlay);

      overlay.querySelector('#adminClose').addEventListener('click', () => document.body.removeChild(overlay));
      overlay.querySelector('#toggleMaintenance').addEventListener('click', async () => {
        await saveSettings({ maintenance: !maintenance });
        overlay.querySelector('#maintenanceStatus').textContent = `Status: ${maintenance ? 'ligado' : 'desligado'}`;
        alert(`Manuten√ß√£o ${maintenance ? 'ativada' : 'desativada'}.`);
      });
      overlay.querySelector('#savePix').addEventListener('click', async () => {
        const val = overlay.querySelector('#pixKeyInput').value.trim();
        if (!val) { toast(overlay.querySelector('#adminStatus'), 'Informe a chave Pix.', '#ef4444'); return; }
        await saveSettings({ pixKey: val });
        overlay.querySelector('#pixKeyInline').textContent = val;
        toast(overlay.querySelector('#adminStatus'), 'Chave Pix atualizada.', '#16a34a');
      });
    });

    // ===== Navega√ß√£o suave =====
    qsa('a[href^="#"]').forEach(a => {
      a.addEventListener('click', (e) => {
        const id = a.getAttribute('href').slice(1);
        const el = document.getElementById(id);
        if (el) { e.preventDefault(); el.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
      });
    });

    // ===== Apoie modal eventos =====
    // j√° configurados acima

  </script>
</body>
</html>
